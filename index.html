<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Smart Reminder - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Kanit', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: all 0.5s ease;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.15);
            padding: 50px;
            max-width: 900px;
            width: 100%;
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* Smile Check Section */
        #smile-check {
            text-align: center;
        }

        #smile-check h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 30px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .smile-emoji {
            font-size: 100px;
            margin-bottom: 30px;
            animation: rotate 2s ease infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
            100% { transform: rotate(-10deg); }
        }

        video {
            width: 100%;
            max-width: 640px;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background: #1a202c;
            margin: 20px auto;
            display: block;
        }

        #smileMessage {
            font-size: 1.3em;
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            font-weight: 500;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .smile-waiting {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #2d3436;
        }

        .smile-detected {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            animation: celebration 0.5s ease;
        }

        @keyframes celebration {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Main App Section */
        #main-app {
            text-align: center;
        }

        #main-app h1 {
            color: #2d3436;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .video-container {
            position: relative;
            margin-bottom: 30px;
        }

        .webcam-placeholder {
            width: 100%;
            max-width: 640px;
            height: 480px;
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: #636e72;
            margin: 0 auto;
        }

        #alert {
            font-size: 1.6em;
            padding: 25px;
            margin: 30px auto;
            border-radius: 20px;
            font-weight: 600;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            max-width: 600px;
        }

        .status-waiting { 
            background: linear-gradient(135deg, #f5f6fa, #dcdde1); 
            color: #718093;
        }

        .status-present { 
            background: linear-gradient(135deg, #55efc4, #00b894); 
            color: white;
            box-shadow: 0 5px 20px rgba(0, 184, 148, 0.3);
        }

        .status-missing { 
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f); 
            color: white;
            animation: pulse 1s ease infinite;
            box-shadow: 0 5px 20px rgba(238, 90, 111, 0.3);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(135deg, #b2bec3, #95a5a6);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
            100% { content: ''; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }
            
            #smile-check h1, #main-app h1 {
                font-size: 1.8em;
            }
            
            .smile-emoji {
                font-size: 70px;
            }
            
            button {
                padding: 12px 24px;
                font-size: 1em;
            }
        }
        </style>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- ‡∏ï‡∏£‡∏ß‡∏à‡∏¢‡∏¥‡πâ‡∏°‡∏Å‡πà‡∏≠‡∏ô -->
  <div id="smile-check" class="container">
    <div class="smile-emoji">üòä</div>
    <h1>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡πâ‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</h1>
    <video id="smileWebcam" autoplay playsinline muted></video>
    <div id="smileMessage" class="smile-waiting">
      üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<span class="loading-dots"></span>
    </div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å Object Detection -->
  <div id="main-app" class="container" style="display:none;">
    <h1>ü§ñ AI Smart Reminder</h1>
    <h2 style="color: #718093; margin-bottom: 30px;">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h2>
    <div class="video-container">
      <video id="webcam" autoplay playsinline muted></video>
    </div>
    <div id="alert" class="status-waiting">üîç ‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</div>
    <div class="controls">
      <button id="toggleCamera">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
      <button id="startDetection" disabled>‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</button>
      <button id="stopDetection" disabled>‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</button>
    </div>
  </div>

  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>
  <script>
    // ==================== SMILE DETECTION ====================
    let smileModel;
    let smileCheckInterval;
    let smileDetectedCount = 0;
    const SMILE_THRESHOLD = 0.7;
    const SMILE_CONFIRM_COUNT = 10;

    const smileWebcamEl = document.getElementById("smileWebcam");
    const smileMessage = document.getElementById("smileMessage");
    const smileCheckDiv = document.getElementById("smile-check");
    const mainAppDiv = document.getElementById("main-app");

    const SMILE_MODEL_URL = "./";

    async function initSmileCheck() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { width: 640, height: 480, facingMode: "user" }
        });
        smileWebcamEl.srcObject = stream;
        await smileWebcamEl.play();

        // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ï‡∏£‡∏ß‡∏à‡∏¢‡∏¥‡πâ‡∏°‡∏à‡∏£‡∏¥‡∏á
        smileModel = await tmImage.load(
          SMILE_MODEL_URL + "model.json",
          SMILE_MODEL_URL + "metadata.json"
        );

        startSmileDetection();
      } catch (err) {
        console.error("Camera error:", err);
        smileMessage.innerHTML = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á";
        setTimeout(() => transitionToMainApp(), 3000);
      }
    }

    async function startSmileDetection() {
      smileCheckInterval = setInterval(async () => {
        const prediction = await smileModel.predict(smileWebcamEl);
        const smilingProb = prediction.find(p => p.className === "present").probability;

        if (smilingProb > SMILE_THRESHOLD) {
          smileDetectedCount++;
          if (smileDetectedCount >= SMILE_CONFIRM_COUNT) {
            onSmileDetected();
          }
        } else {
          smileDetectedCount = Math.max(0, smileDetectedCount - 1);
        }
      }, 200);
    }

    function onSmileDetected() {
      clearInterval(smileCheckInterval);
      smileMessage.innerHTML = "üéâ ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡πâ‡∏°‡πÅ‡∏•‡πâ‡∏ß! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
      smileMessage.className = "smile-detected";
      setTimeout(() => transitionToMainApp(), 2000);
    }

    function transitionToMainApp() {
      if (smileWebcamEl.srcObject) {
        smileWebcamEl.srcObject.getTracks().forEach(track => track.stop());
      }
      smileCheckDiv.style.display = "none";
      mainAppDiv.style.display = "block";
      initObjectDetection();
    }

    // ==================== OBJECT DETECTION ====================
    let objectModel = null;
    let isDetecting = false;
    let isCameraOn = false;

    const webcamElement = document.getElementById('webcam');
    const alertElement = document.getElementById('alert');
    const toggleCameraBtn = document.getElementById('toggleCamera');
    const startBtn = document.getElementById('startDetection');
    const stopBtn = document.getElementById('stopDetection');

    const OBJECT_MODEL_URL = "./";

    async function initObjectDetection() {
      try {
        objectModel = await tmImage.load(
          OBJECT_MODEL_URL + "model.json",
          OBJECT_MODEL_URL + "metadata.json"
        );
        alertElement.innerHTML = '‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
        alertElement.className = 'status-present';
        setTimeout(() => {
          alertElement.innerHTML = 'üîç ‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö';
          alertElement.className = 'status-waiting';
        }, 2000);
      } catch (error) {
        console.error('Error loading model:', error);
        alertElement.innerHTML = "‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß";
      }
    }

    toggleCameraBtn.addEventListener("click", async () => {
      if (!isCameraOn) {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        webcamElement.srcObject = stream;
        webcamElement.style.display = "block";
        toggleCameraBtn.textContent = "üì∑ ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á";
        startBtn.disabled = false;
        isCameraOn = true;
      } else {
        webcamElement.srcObject.getTracks().forEach(track => track.stop());
        webcamElement.style.display = "none";
        toggleCameraBtn.textContent = "üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á";
        startBtn.disabled = true;
        stopBtn.disabled = true;
        isCameraOn = false;
      }
    });

    startBtn.addEventListener("click", () => {
      if (!objectModel) return;
      isDetecting = true;
      startBtn.disabled = true;
      stopBtn.disabled = false;
      detectLoop();
    });

    stopBtn.addEventListener("click", () => {
      isDetecting = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
    });

    async function detectLoop() {
      while (isDetecting) {
        const prediction = await objectModel.predict(webcamElement);
        const presentProb = prediction.find(p => p.className === "present").probability;
        const missingProb = prediction.find(p => p.className === "missing").probability;

        if (presentProb > missingProb) {
          alertElement.innerHTML = "üü¢ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ü‡∏£‡∏°";
          alertElement.className = "status-present";
        } else {
          alertElement.innerHTML = "üî¥ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏´‡∏≤‡∏¢‡πÑ‡∏õ";
          alertElement.className = "status-missing";
        }
        await tf.nextFrame();
      }
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    initSmileCheck();
  </script>
</body>
</html>
